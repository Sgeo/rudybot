#!/usr/bin/pagsh.openafs
# -*- shell-script -*-

# This is for mire.hcoop.net, which uses kerberos.  It tries to
# prevent the kerberos tickets from timing out.

# Before I ran this the first time, I had to twiddle some acls from
# their defaults: I did "fs setacl -dir . -acl offby1.daemon rlidwk"
# in this directory, and the parent of this directory.
# ("offby1.daemon" is the user that runs the script; it's different
# from offby1, which is the user ID I get when I log in interactively)

# If, when you run this, you see

# $ ./kerb-wrapper
# /bin/sh: Can't open ./kerb-wrapper

# that means you need to give "system:anyuser" "rl" access to this
# directory, and all its parents.


here=$(cd $(dirname $0); pwd)
pidfile="$here"/k5start.pid

if [ -f "$pidfile" ]
then
    kill $(cat "$pidfile")
    rm -f "$pidfile"
fi

/usr/bin/k5start -U -K 300 -t                   \
    -p "$pidfile"                               \
    -f /etc/keytabs/user.daemon/$USER           \
    "$here"/go "$@"
